# - name: pull postgres
#   shell: docker pull postgres:9.4
#   tags: [common]

# - name: first run and init postgres
#   shell: docker run \
#            -e "POSTGRES_USER={{ postgres_user }}" \
#            -e "POSTGRES_PASSWORD={{ postgres_password }}" \
#            -v {{ postgres_data }}:/var/lib/postgresql/data \
#            postgres:9.4
#   tags: [common]
#   become: yes

# - lineinfile:
#     line: '{{ item }}'
#     dest: "{{ postgres_data }}/pg_hba.conf"
#     state: present
#   become: yes
#   with_items:
#     - "host all postgres {{ docker_ip }}/32 trust"
#     - "host all all 0.0.0.0/0 trust"
#     - "host  replication  {{ postgres_replication_user }}  0.0.0.0/0  md5"
#     - "host  replication  {{ postgres_replication_user }}  0.0.0.0/0  md5"
#   tags: database

# - lineinfile:
#     line: '{{ item }}'
#     dest: "{{ postgres_data }}/postgresql.conf"
#     state: present
#   become: yes
#   with_items:
#     - "wal_level = hot_standby"
#     - "checkpoint_segments = 8"
#     - "max_wal_senders = 3"
#     - "wal_keep_segments = 8"
#     - "hot_standby = on"
#   tags: database

# # - name: starting base backup on slave
# #   shell: ./postgres.sh /bin/sh -c "echo '{{postgres_replication_password }}' | \

# #  g_basebackup -h {{ master_ip }} -D {{ postgres_data }} -U {{ postgres_replication_user }} -W -v"


