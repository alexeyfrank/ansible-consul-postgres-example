description "Postgres"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

env HOME=/home/{{ run_user }}
setuid {{ run_user }}
setgid docker

respawn
respawn limit 3 30

pre-start script
    /usr/bin/docker rm -f postgres || true
    docker pull postgres:9.4
end script

pre-stop script
    /usr/bin/docker rm -f postgres || true
end script

script
    docker run --name postgres \
           -e "SERVICE_NAME=postgres-master" \
           -e "POSTGRES_USER={{ postgres_user }}" \
           -e "POSTGRES_PASSWORD={{ postgres_password }}" \
           -p 0.0.0.0:5432:5432 \
           -v /volumes/data:/var/lib/postgresql/data \
           postgres:9.4
end script



